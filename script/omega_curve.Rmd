  
```{r}
library(ggplot2)
library(zoo)
```

```{r}

omega <- read.csv('../input/fagales_omega.csv')

# Calculate the sliding window average
window_size <- 25
omega$Sliding_Average <- zoo::rollapply(omega$dN.dS, 
                                                      width = window_size, 
                                                      by = 1, 
                                                      FUN = mean, 
                                                      align = 'center', 
                                                      fill = NA)
# Define the custom ggplot theme
my_ggplot_theme <- theme_linedraw() +
  theme(text = element_text(size = 16, family = "Helvetica"),
        axis.title.x = element_text(size = 14, color = "black", family = "Helvetica"),
        axis.title.y = element_text(size = 14, color = "black", family = "Helvetica"),
        axis.text.x = element_text(size = 12, color = "black", family = "Helvetica"),
        axis.text.y = element_text(size = 14, color = "black", family = "Helvetica"),
        axis.ticks = element_line(size = 0.8),
        axis.ticks.length.y = unit(1.5, "mm"),
        plot.background = element_rect(fill = "white"),
        panel.grid = element_blank(), 
        panel.border = element_rect(color = "black", size = 0.8))

# Create the plot with vertical lines at specified positions and apply the custom theme
p <- ggplot(omega, aes(x = pos, y = Sliding_Average)) +
    #geom_line(size = 1.0) + # Adjust this value to make the line thicker
    geom_smooth(se = FALSE, method = "loess", span = 0.05, color = "black") + # Add a smooth curve (change span for smoothness)
    geom_vline(xintercept = c(247, 391, 412, 439, 460), color = "red", linetype = "longdash") +
    my_ggplot_theme +
    #scale_y_continuous(limits = c(-1, 5)) + # Set y-axis max to 9
    scale_x_continuous(breaks = seq(100, 700, by = 100)) + # Set x-axis breaks at every 100 units
    labs(title = "Fagales",
         x = "Amino Acid Position",
         y = "omega dN/dS")

# Save the plot to a file
ggsave("../output/QvFLS2_omega.pdf", plot = p, width = 10, height = 5, dpi = 300)

# Print the plot to the R console
print(p)

```


#### Combined Curves
```{r}
library(ggplot2)
library(zoo)
library(dplyr)

# Function to read data and calculate sliding average
read_and_smooth <- function(file_path, window_size) {
  # Read the CSV file
  omega <- read.csv(file_path)
  
  # Calculate the sliding window average
  omega$Sliding_Average <- zoo::rollapply(omega$dN.dS, 
                                           width = window_size, 
                                           by = 1, 
                                           FUN = mean, 
                                           align = 'center', 
                                           fill = NA)
  # Add a column for the group (file identifier)
  omega$Group <- gsub(".*?/(.*)\\.csv$", "\\1", file_path)
  
  return(omega)
}

# Define the window size for smoothing
window_size <- 80

# Read and smooth data from all CSV files
files <- c("../input/fagales_omega.csv", "../input/brassicales_omega.csv", "../input/rosales_omega.csv")
omega_data <- lapply(files, function(f) read_and_smooth(f, window_size))

# Combine all data frames into one
omega_data_combined <- do.call(rbind, omega_data)

# Define the custom ggplot theme
my_ggplot_theme <- theme_linedraw() +
  theme(text = element_text(size = 16, family = "Helvetica"),
        axis.title.x = element_text(size = 14, color = "black", family = "Helvetica"),
        axis.title.y = element_text(size = 14, color = "black", family = "Helvetica"),
        axis.text.x = element_text(size = 12, color = "black", family = "Helvetica"),
        axis.text.y = element_text(size = 14, color = "black", family = "Helvetica"),
        axis.ticks = element_line(size = 0.8),
        axis.ticks.length.y = unit(1.5, "mm"),
        plot.background = element_rect(fill = "white"),
        panel.grid = element_blank(), 
        panel.border = element_rect(color = "black", size = 0.8))

# Create the plot with smooth curves for each dataset
p <- ggplot(omega_data_combined, aes(x = pos, y = Sliding_Average, color = Group)) +
  #geom_line(size = 1.1) + 
  #geom_smooth(se = FALSE, method = "loess", span = 0.3) +
  geom_line(size = 1.1) + 
  #geom_smooth(se = FALSE, method = "loess", span = 0.01) +
  my_ggplot_theme +
  scale_x_continuous(breaks = seq(100, 700, by = 100)) +
  labs(title = "ω dN/dS Across Plant orders",
       x = "Amino Acid Position",
       y = "ω dN/dS",
       color = "Plant order") +  # Update the legend title
  scale_color_manual(values = c("#8DA0CB", "#FC8D62", "#66C2A5", "#D55E00"),
                     labels = c("Brassicales order", "Fagales order", "Rosales order"))  # Update the legend labels

# Save the plot to a file
ggsave("../output/combined_omega_curves.pdf", plot = p, width = 13, height = 5, dpi = 300)

# Print the plot to the R console
print(p)

```


``{r}
library(ggplot2)
library(zoo)
library(dplyr)

# Function to read data and calculate sliding average
read_and_smooth <- function(file_path, window_size) {
  # Read the CSV file
  omega <- read.csv(file_path)
  
  # Calculate the sliding window average
  omega$Sliding_Average <- zoo::rollapply(omega$dN.dS, 
                                           width = window_size, 
                                           by = 1, 
                                           FUN = mean, 
                                           align = 'center', 
                                           fill = NA)
  # Add a column for the group (file identifier)
  omega$Group <- gsub(".*?/(.*)\\.csv$", "\\1", file_path)
  
  return(omega)
}

# Define the window size for smoothing
window_size <- 15

# Read and smooth data from all CSV files
files <- c("../input/fagales_omega.csv", "../input/brassicales_omega.csv", "../input/rosales_omega.csv")
omega_data <- lapply(files, function(f) read_and_smooth(f, window_size))

# Combine all data frames into one
omega_data_combined <- do.call(rbind, omega_data)

# Define the custom ggplot theme
my_ggplot_theme <- theme_linedraw() +
  theme(text = element_text(size = 16, family = "Helvetica"),
        axis.title.x = element_text(size = 14, color = "black", family = "Helvetica"),
        axis.title.y = element_text(size = 14, color = "black", family = "Helvetica"),
        axis.text.x = element_text(size = 12, color = "black", family = "Helvetica"),
        axis.text.y = element_text(size = 14, color = "black", family = "Helvetica"),
        axis.ticks = element_line(size = 0.8),
        axis.ticks.length.y = unit(1.5, "mm"),
        plot.background = element_rect(fill = "white"),
        panel.grid = element_blank(), 
        panel.border = element_rect(color = "black", size = 0.8))

# Create the plot with smooth curves for each dataset
p <- ggplot(omega_data_combined, aes(x = pos, y = dN.dS, color = Group)) +
  #geom_line(size = 1.0) + # Adjust this value to make the line thicker
  geom_smooth(se = FALSE, method = "loess", span = 0.27) +
  my_ggplot_theme +
  scale_x_continuous(breaks = seq(100, 700, by = 100)) +
  labs(title = "Omega dN/dS Across Groups",
       x = "Amino Acid Position",
       y = "omega dN/dS") +
  scale_color_manual(values = c("red", "blue", "green", "purple")) # Customize the colors

# Save the plot to a file
ggsave("../output/combined_omega_curves.pdf", plot = p, width = 10, height = 5, dpi = 300)

# Print the plot to the R console
print(p)


```
